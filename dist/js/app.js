"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var APIkeyWinTransit="eM0x2PJKCyqqY7BOlun",APIkeyMapbox="pk.eyJ1IjoibWlsaXRvbSIsImEiOiJja2E2YmtpN2cwNmhzMnlvejA0cm5kamtpIn0.DvZmdFkPPyBWuuW-TgOpTw",geoBorderWinnipeg="-97.325875, 49.766204, -96.953987, 49.99275",ulElem=document.querySelectorAll("ul.origins, ul.destinations"),formElem=document.querySelectorAll("form"),ulTripElem=document.querySelector(".my-trip");function findLocation(e,t){fetch("https://api.mapbox.com/geocoding/v5/mapbox.places/".concat(e,".json?limit=10&bbox=").concat(geoBorderWinnipeg,"&access_token=").concat(APIkeyMapbox)).then(function(e){return e.json()}).then(function(e){deletePreviousSearch(t),e.features.forEach(function(e){displayLocations(e,t)})})}function deletePreviousSearch(t){ulElem.forEach(function(e){e.className.includes(t)&&(e.innerHTML="")})}function displayLocations(t,n){ulElem.forEach(function(e){e.className.includes(n)&&e.insertAdjacentHTML("beforeend","<li data-long=".concat(t.center[0]," data-lat=").concat(t.center[1],'>\n          <div class="name">').concat(t.text,"</div>\n          <div>").concat(t.properties.address,"</div>\n        </li>"))})}function getAllSiblings(t,e){return _toConsumableArray(e.children).filter(function(e){return e!==t})}function getGeoData(e,t){var n,r,a,o="";null!==e&&null!==t&&(n=e.dataset.long,r=e.dataset.lat,a=t.dataset.long,o=t.dataset.lat),void 0!==n&&void 0!==r&&void 0!==a&&void 0!==o&&planTrip(n,r,a,o)}function planTrip(e,t,n,r){document.querySelector(".plan-trip").addEventListener("click",function(){fetch("https://api.winnipegtransit.com/v3/trip-planner.json?origin=geo/".concat(t,",").concat(e,"&destination=geo/").concat(r,",").concat(n,"&usage=long&api-key=").concat(APIkeyWinTransit)).then(function(e){return e.json()}).then(function(e){0<e.plans.length?(deletePreviousPlan(),e.plans[0].segments.forEach(function(e){return displayPlan(e)})):ulTripElem.innerHTML="Unavailable at the moment."})})}function deletePreviousPlan(){ulTripElem.innerHTML=""}function displayPlan(e){ulTripElem.insertAdjacentHTML("beforeend",'<li>\n      <i class="'.concat(setIcon(e.type),'" aria-hidden="true"></i>\n      ').concat(setText(e),"\n    </li>"))}function setIcon(e){var t;switch(e){case"ride":t="fas fa-bus";break;case"transfer":t="fas fa-ticket-alt";break;default:t="fas fa-walking"}return t}function setText(e){var t;switch(e.type){case"ride":t="".concat(e.type.capitalize()," the ").concat(checkBlue(e.route)," for ").concat(checkPlural(e.times.durations.riding),".");break;case"transfer":t="".concat(e.type.capitalize()," from stop #").concat(e.from.stop.key," - ").concat(e.from.stop.name," to stop #").concat(e.to.stop.key," - ").concat(e.to.stop.name,".");break;default:t="".concat(e.type.capitalize()," for ").concat(checkPlural(e.times.durations.walking)," to ").concat(checkLastStep(e.to),".")}return t}function checkBlue(e){return null!==e.name&&void 0!==e.name?"".concat(e.name):"".concat(e.key)}function checkPlural(e){var t="".concat(e,1===e?" minute":" minutes");return t}function checkLastStep(e){return null!=e&&checkProperty(e,"stop")?"stop #".concat(e.stop.key," - ").concat(e.stop.name):"your destination"}function checkProperty(e,t){return Object.prototype.hasOwnProperty.call(e,t)}formElem.forEach(function(e){return e.addEventListener("submit",function(e){var t=e.target.querySelector("input"),n=e.target.closest("form").className.slice(0,-5);0<t.value.length&&findLocation(t.value,n),e.preventDefault()})}),ulElem.forEach(function(e){return e.addEventListener("click",function(e){var t,n=e.target.closest("li"),r=n.closest("ul");null!==n&&(t=getAllSiblings(n,r),n.classList.add("selected"),t.forEach(function(e){return e.classList.remove("selected")}),getGeoData(document.querySelector(".origins > .selected"),document.querySelector(".destinations > .selected")))})}),String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)};